{% extends "base_template.html" %}

{% block title %}Your Page - Data Visualization{% endblock %}

{% block heading %}Your Page{% endblock %}

{% block content %}
    <label for="startDate">Start Date:</label>
    <input type="date" id="startDate" required>
    <label for="endDate">End Date:</label>
    <input type="date" id="endDate" required>
    <button onclick='fetchData()'>Fetch Data</button>
    <div style="width: 600px; height: 450px;">
        <canvas id="chartContainer"></canvas>
    </div>  
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment"></script>
    <script>
        async function fetchData() {
            try {
                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;
                const stock = 'Adani Enterprises Ltd.'
                const response = await fetch(`/data?stock=${stock}&startDate=${startDate}&endDate=${endDate}`);
        
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
        
                const data = await response.json();
        
                console.log(data);
        
                const dates = data.map(entry => entry.date); 
                const values = data.map(entry => entry.CLOSE);
        
                console.log('Dates:', dates);
                console.log('Values:', values);
        
                const ctx = document.getElementById('chartContainer').getContext('2d');
                const existingChart = Chart.getChart(ctx);
                if (existingChart) {
                    existingChart.destroy();
                }
                const myChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dates,
                        datasets: [{
                            label: 'Values',
                            data: values,
                            borderColor: 'rgb(75, 192, 192)',
                            borderWidth: 2,
                            fill: false,
                            pointStyle: 'none',
                            pointRadius: 0,
                        }],
                    },
                    options: {
                        scales: {
                            x: {
                                type: 'time',
                                time: {
                                    unit: 'day',
                                },
                            },
                            y: {
                                beginAtZero: false,
                            },
                        },
                    },
                });
            } catch (error) {
                console.error('Error fetching or processing data:', error);
            }
        }
    </script>
{% endblock %}
