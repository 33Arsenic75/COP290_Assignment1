<!DOCTYPE html>
<html>
<head>
    <title>StockMarket</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style_new.css') }}">
</head>
<body>
    <div class="navbar">
        <h1> StockMarket </h1>
        <button class="navbtn" style="background-color: black; color: white;" id="dark-mode-toggle"> Enable Dark Mode </button>
        <a href="/dashboard" class="navbtn btn-about">  Back to Dashboard </a>
        <a href="/" class="navbtn btn-logout">Logout</a>
    </div>
    <div class="stocks-area">
        <div style="font-size: 3.5em;">Filter</div>
        <hr style="opacity: 0.25;"/>
        <input list="tables" id="selectTable" placeholder="Filter By">
        <datalist id="tables">
            <option value='P/E Ratio'>
            <option value='CLOSE'>
            <option value='VOLUME'>
            <option value='VALUE'>
            <option value='LTP'>
            <option value='NO OF TRADES'>
        </datalist>
    </div>
    <div class="stocks-area">
        <hr style="opacity: 0.25;"/>
        <input list="duration" id="durationInput" placeholder="Duration">
        <datalist id="duration">
            <option value='1 Month'>
            <option value='1 Year'>
            <option value='5 Years'>
        </datalist>
    </div>
    <div>
        <label for="lowerBound">Lower Bound:</label>
        <input type="number" id="lowerBound" name="lowerBound" placeholder="Enter Lower Bound" />
    </div>

    <div>
        <label for="upperBound">Upper Bound:</label>
        <input type="number" id="upperBound" name="upperBound" placeholder="Enter Upper Bound" />
    </div>
    <br><br/>
    <div id="dynamicDataContainer"></div>

    <button onclick="getData()">Get Data</button>
    <button onclick="Reset()">Reset</button>
    <script>
        /// to resent the filter
        function Reset(){
            dynamicDataContainer.innerHTML = '';
            document.getElementById('lowerBound').value = null;
            document.getElementById('upperBound').value = null;
            document.getElementById('selectTable').value=null;
            document.getElementById('durationInput').value=null;
        }
    </script>
    <script>
        /// to rendert the data for current selection
        function getData() {
            // Retrieve values after the button is clicked
            const category = document.getElementById("selectTable").value;
            const duration = document.getElementById("durationInput").value;
            const lowerBound = document.getElementById("lowerBound").value;
            const upperBound = document.getElementById("upperBound").value;
            if (category === 'P/E Ratio') {
                PERatio(duration, lowerBound, upperBound);
            } else {
                Default(category,duration, lowerBound, upperBound);
            }
        }
        async function PERatio(duration, lowerBound, upperBound) {
            /// to filter PERation
            month = 0;
            if(duration=="1 Month"){
                month = 1;
            }
            else if(duration=="1 Year"){
                month = 12;
            }
            else{
                month = 60;
            }
            const requestData = {
                month: month,
                lowerBound: lowerBound,
                upperBound: upperBound
            };
            const response = await fetch('/PE_filter', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            })
            const result = await response.json();
            dynamicDataContainer.innerHTML = '';
            console.log(result);
            for (const key in result) {
                if (result.hasOwnProperty(key)) {
                    const value = result[key];
                    const keyValueDiv = document.createElement('div');
                    const keyElement = document.createElement('span');
                    const valueElement = document.createElement('span');
                    keyElement.innerText = `${key}: `;
                    valueElement.innerText = `${value}: `;
                    keyValueDiv.innerText = `${key}: ${value}`;
                    dynamicDataContainer.appendChild(keyElement);
                    dynamicDataContainer.appendChild(valueElement);
                    dynamicDataContainer.appendChild(document.createElement('br'));
                }
              }
        }
        
        async function Default(category, duration, lowerBound, upperBound) {
            // to filter anything other than PERatio
            month = 0;
            if(duration=="1 Month"){
                month = 1;
            }
            else if(duration=="1 Year"){
                month = 12;
            }
            else{
                month = 60;
            }
            const requestData = {
                category: category,
                month: month,
                lowerBound: lowerBound,
                upperBound: upperBound
            };
            const response = await fetch('/default_filter', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            })
            const result = await response.json();
            dynamicDataContainer.innerHTML = '';
            console.log(result);
            for (const key in result) {
                if (result.hasOwnProperty(key)) {
                    const value = result[key];
                    const keyValueDiv = document.createElement('div');
                    const keyElement = document.createElement('span');
                    const valueElement = document.createElement('span');
                    keyElement.innerText = `${key}: `;
                    valueElement.innerText = `${value}: `;
                    keyValueDiv.innerText = `${key}: ${value}`;
                    dynamicDataContainer.appendChild(keyElement);
                    dynamicDataContainer.appendChild(valueElement);
                    dynamicDataContainer.appendChild(document.createElement('br'));
                }
              }
        }
    </script>
    <script>
        // for darkmode
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const body = document.body;
        const navbar = document.querySelector('.navbar');

        darkModeToggle.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            navbar.classList.toggle('dark-mode-navbar');
            if (body.classList.contains('dark-mode')) {
                darkModeToggle.innerText = 'Enable Light Mode';
                darkModeToggle.style.backgroundColor = 'white';
                darkModeToggle.style.color = 'black';
            } else {
                darkModeToggle.innerText = 'Enable Dark Mode';
                darkModeToggle.style.backgroundColor = 'black';
                darkModeToggle.style.color = 'white';
            }
        });
    </script>
    <script>
        var inputElement = document.getElementById("selectTable");
    </script>
</body>
</html>